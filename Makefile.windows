.PHONY: help setup install dev dev-backend dev-frontend test lint format clean podman-up podman-down status

help:
	@echo AI Video Editor - Windows Development Commands
	@echo ===============================================
	@echo.
	@echo Setup Commands:
	@echo   make setup              - Complete project setup
	@echo   make install            - Install all dependencies
	@echo.
	@echo Development Commands:
	@echo   make dev                - Start all services with Podman
	@echo   make dev-backend        - Start backend only
	@echo   make dev-frontend       - Start frontend only
	@echo.
	@echo Podman Commands:
	@echo   make podman-up          - Start Podman containers
	@echo   make podman-down        - Stop Podman containers
	@echo.
	@echo Quality Commands:
	@echo   make test               - Run all tests
	@echo   make lint               - Lint code
	@echo   make format             - Format code
	@echo.
	@echo Cleanup Commands:
	@echo   make clean              - Remove cache files
	@echo   make status             - Show project status

setup: install
	@echo.
	@echo âœ… Setup complete!
	@echo Next: make dev

install:
	@echo ğŸ“¦ Installing backend dependencies...
	cd backend && python -m venv venv
	cd backend && .\venv\Scripts\pip install --upgrade pip
	cd backend && .\venv\Scripts\pip install uv
	cd backend && .\venv\Scripts\uv pip install -e ".[dev]"
	@echo âœ… Backend dependencies installed
	@echo.
	@echo ğŸ“¦ Installing frontend dependencies...
	cd frontend && npm install
	@echo âœ… Frontend dependencies installed

dev: podman-up
	@echo.
	@echo âœ… All services started with Podman!
	@echo Frontend: http://localhost:3000
	@echo Backend: http://localhost:8000
	@echo API Docs: http://localhost:8000/docs

dev-backend:
	@echo ğŸš€ Starting backend...
	cd backend && .\venv\Scripts\uvicorn app.main:app --reload --host 0.0.0.0 --port 8000

dev-frontend:
	@echo ğŸš€ Starting frontend...
	cd frontend && npm run dev

podman-up:
	@echo ğŸ³ Starting Podman containers...
	podman-compose -f docker-compose.yml up -d
	@echo âœ… Containers started

podman-down:
	@echo ğŸ›‘ Stopping Podman containers...
	podman-compose -f docker-compose.yml down
	@echo âœ… Containers stopped

podman-logs:
	@echo ğŸ“‹ Podman logs...
	podman-compose -f docker-compose.yml logs -f

podman-ps:
	@echo ğŸ“Š Podman containers status...
	podman-compose -f docker-compose.yml ps

test:
	@echo ğŸ§ª Running tests...
	cd backend && .\venv\Scripts\pytest tests/ -v --cov=app

lint:
	@echo ğŸ” Linting code...
	cd backend && .\venv\Scripts\ruff check app/
	cd frontend && npm run lint

format:
	@echo âœ¨ Formatting code...
	cd backend && .\venv\Scripts\black app/
	cd frontend && npm run format

clean:
	@echo ğŸ§¹ Removing cache files...
	cd backend && rmdir /s /q __pycache__ 2>nul || true
	cd backend && rmdir /s /q .pytest_cache 2>nul || true
	cd frontend && rmdir /s /q node_modules\.cache 2>nul || true
	@echo âœ… Cleanup complete

status:
	@echo ğŸ“Š Project Status
	@echo =================
	@echo.
	@echo Backend:
	@if exist "backend\venv" (echo   âœ… Virtual environment exists) else (echo   âŒ Virtual environment missing)
	@echo.
	@echo Frontend:
	@if exist "frontend\node_modules" (echo   âœ… Dependencies installed) else (echo   âŒ Dependencies not installed)
	@echo.
	@echo Podman:
	podman-compose -f docker-compose.yml ps
